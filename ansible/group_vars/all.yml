---
# Non-secret defaults for OpenClaw provisioning.
# Secrets are passed via scripts/provision.sh from Pulumi config.

openclaw_timezone: "Europe/Berlin"
openclaw_model_primary: "anthropic/claude-opus-4-6"
openclaw_model_fallbacks:
  - "anthropic/claude-opus-4-5"
openclaw_thinking_default: "high"

# Custom model definitions (for models not yet in OpenClaw's built-in registry)
openclaw_custom_models:
  mode: "merge"
  providers:
    anthropic:
      baseUrl: "https://api.anthropic.com"
      api: "anthropic-messages"
      models:
        - id: "claude-opus-4-6"
          name: "Claude Opus 4.6"
          reasoning: true
          input: ["text", "image"]
          contextWindow: 1000000
          maxTokens: 128000
openclaw_heartbeat_interval: "30m"
openclaw_elevated_default: "off"

# Sandbox settings
openclaw_sandbox_mode: "all"
openclaw_sandbox_workspace_access: "rw"
openclaw_sandbox_docker_network: "codex-proxy-net"
openclaw_sandbox_docker_image: "openclaw-sandbox-custom:latest"
openclaw_sandbox_read_only_root: false  # Allow runtime pip/npm/curl installs (see docs/SECURITY.md §4)

# Force sandbox image rebuild (override with -e force_sandbox_rebuild=true)
force_sandbox_rebuild: false

# Force Codex MCP Docker image rebuild (override with -e force_codex_rebuild=true)
force_codex_rebuild: false

# Force Claude Code MCP Docker image rebuild (override with -e force_claude_code_rebuild=true)
force_claude_code_rebuild: false

# Force Pi MCP Docker image rebuild (override with -e force_pi_mcp_rebuild=true)
force_pi_mcp_rebuild: false

# Force plugin reinstall (override with -e force_plugin_reinstall=true)
force_plugin_reinstall: false

# Force qmd reindex (override with -e force_qmd_reindex=true)
force_qmd_reindex: false

# qmd semantic search settings
# Pin to commit hash for reproducibility (bun uses github:user/repo#hash syntax)
qmd_version: "785bbcf319cf60d9e81b8307a1ea89bcdf3159c2"

# Agent definitions
# "main" is the built-in default agent (andy). manon and tl are additional agents.
openclaw_agents:
  - id: "main"
    is_default: true
    deliver_to: "{{ telegram_user_id | default('') }}"
    deliver_type: "dm"
  - id: "manon"
    is_default: false
    deliver_to: "{{ telegram_manon_user_id | default('') }}"
    deliver_type: "dm"
  - id: "tl"
    is_default: false
    deliver_to: "{{ telegram_group_id | default('') }}"
    deliver_type: "group"

# Legacy cron job names (removed during migration to per-agent jobs)
openclaw_legacy_cron_names:
  - "Morning Digest"
  - "Evening Review"
  - "Night Shift"
  - "Weekly Planning"

# Per-agent cron jobs (only created when telegram is configured)
openclaw_cron_jobs:
  # main (andy)
  - name: "main: Daily Standup"
    agent: "main"
    schedule: "30 9 * * *"
    message: "Good morning! Summarize what needs my attention today."
  - name: "main: Night Shift"
    agent: "main"
    schedule: "0 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."
  - name: "main: Weekly Review"
    agent: "main"
    schedule: "0 15 * * 5"
    message: "Weekly review. What was accomplished this week? What is pending?"
  - name: "main: Weekly Planning"
    agent: "main"
    schedule: "0 10 * * 1"
    message: "Weekly planning. Review past week, plan upcoming week priorities."
  # manon
  # - name: "manon: Daily Standup"
  #   agent: "manon"
  #   schedule: "0 10 * * *"
  #   message: "Good morning! Summarize what needs my attention today."
  - name: "manon: Night Shift"
    agent: "manon"
    schedule: "30 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."
  # - name: "manon: Weekly Review"
  #   agent: "manon"
  #   schedule: "30 15 * * 5"
  #   message: "Weekly review. What was accomplished this week? What is pending?"
  # - name: "manon: Weekly Planning"
  #   agent: "manon"
  #   schedule: "30 10 * * 1"
  #   message: "Weekly planning. Review past week, plan upcoming week priorities."
  # tl
  - name: "tl: Daily Standup"
    agent: "tl"
    schedule: "45 9 * * *"
    message: "Good morning team! Summarize what needs attention today."
  - name: "tl: Night Shift"
    agent: "tl"
    schedule: "15 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."
  - name: "tl: Weekly Review"
    agent: "tl"
    schedule: "15 15 * * 5"
    message: "Weekly review. What was accomplished this week? What is pending?"
  - name: "tl: Weekly Planning"
    agent: "tl"
    schedule: "15 10 * * 1"
    message: "Weekly planning. Review past week, plan upcoming week priorities."

# MCP plugin configuration
openclaw_mcp_adapter:
  source: "https://github.com/pandysp/openclaw-mcp-adapter.git"
  npm_packages:
    - "@modelcontextprotocol/server-github"
    - "@openai/codex"
  tool_prefix: true
  codex_sandbox: "workspace-write"
  codex_approval: "never"
  codex_docker_image: "codex-mcp:latest"
  codex_version: "0.98.0"        # Pin for reproducibility; update intentionally
  codex_memory_limit: "2g"       # Prevent runaway Codex from exhausting VPS RAM
  codex_proxy_port: 8787         # Port for the credential-injecting reverse proxy
  # Claude Code settings
  claude_code_docker_image: "claude-code-mcp:latest"
  claude_code_version: "2.1.38"     # Pin @anthropic-ai/claude-code CLI for reproducibility
  claude_code_mcp_version: "2.2.0"  # Pin @pandysp/claude-code-mcp server for reproducibility
  claude_code_memory_limit: "2g"    # Monitor and adjust — Claude Code may need more than Codex
  # Pi MCP settings
  pi_mcp_docker_image: "pi-mcp:latest"
  pi_mcp_version: "0.1.2"
  pi_mcp_memory_limit: "1g"    # Lower than Codex/Claude Code — Pi is lighter (session trees, not full IDE)
  pi_mcp_model: "claude-opus-4-6"
  pi_mcp_thinking: "xhigh"
  servers:
    # GitHub MCP servers (one per agent, each with its own PAT)
    - name: "github"
      type: "github"
      token_var: "github_token"
      agent_id: "main"
    - name: "github-manon"
      type: "github"
      token_var: "github_token_manon"
      agent_id: "manon"
    - name: "github-tl"
      type: "github"
      token_var: "github_token_tl"
      agent_id: "tl"
    # Codex MCP servers (one per agent, uses cached ~/.codex/auth.json, workspace-scoped cwd)
    - name: "codex"
      type: "codex"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "codex-manon"
      type: "codex"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "codex-tl"
      type: "codex"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # Claude Code MCP servers (one per agent, reuses claude_setup_token, workspace-scoped cwd)
    - name: "claude"
      type: "claude-code"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "claude-manon"
      type: "claude-code"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "claude-tl"
      type: "claude-code"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # Pi MCP servers (one per agent, reuses claude_setup_token, workspace-scoped cwd)
    - name: "pi"
      type: "pi"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "pi-manon"
      type: "pi"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "pi-tl"
      type: "pi"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # qmd semantic search servers (one per agent, local — no credentials needed)
    - name: "qmd"
      type: "qmd"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "qmd-manon"
      type: "qmd"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "qmd-tl"
      type: "qmd"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"

# Claude Code plugins for MCP containers
claude_code_plugins:
  config_dir: "/home/ubuntu/.openclaw/claude-code-plugins"
  marketplaces:
    - repo: "anthropics/claude-plugins-official"
    - repo: "pandysp/claude-plugins"
  plugins:
    - "code-review"
    - "code-simplifier"
    - "commit-commands"
    - "feature-dev"
    - "frontend-design"
    - "hookify"
    - "plugin-dev"
    - "pr-review-toolkit"
    - "ralph-loop"
    - "security-guidance"
    - "ty-lsp@pandysp"
    - "typescript-lsp@pandysp"

# Obsidian vault definitions (cloned into <workspace>/Obsidian/<name>/)
# Agents pull/push manually from Docker sandbox. Uses existing GitHub PATs via HTTPS.
openclaw_obsidian_vaults:
  - name: "andy-vault"
    repo_url: "{{ obsidian_andy_vault_repo_url | default('') }}"
    agents: ["main"]
  - name: "manon-vault"
    repo_url: "{{ obsidian_manon_vault_repo_url | default('') }}"
    agents: ["manon"]
  - name: "tl-vault"
    repo_url: "{{ obsidian_tl_vault_repo_url | default('') }}"
    agents: ["main", "manon", "tl"]

# Explicit agent → GitHub PAT mapping for Obsidian HTTPS clones (reuses existing MCP PATs)
openclaw_obsidian_github_tokens:
  main: "{{ github_token | default('') }}"
  manon: "{{ github_token_manon | default('') }}"
  tl: "{{ github_token_tl | default('') }}"

# Workspace git sync definitions (per-agent)
openclaw_workspaces:
  - agent_id: "main"
    repo_url: "{{ workspace_repo_url | default('') }}"
    deploy_key: "{{ workspace_deploy_key | default('') }}"
    workspace_dir: "/home/ubuntu/.openclaw/workspace"
    ssh_alias: "github-workspace-main"
    key_file: "workspace-deploy-key"
  - agent_id: "manon"
    repo_url: "{{ workspace_manon_repo_url | default('') }}"
    deploy_key: "{{ workspace_manon_deploy_key | default('') }}"
    workspace_dir: "/home/ubuntu/.openclaw/workspace-manon"
    ssh_alias: "github-workspace-manon"
    key_file: "workspace-deploy-key-manon"
  - agent_id: "tl"
    repo_url: "{{ workspace_tl_repo_url | default('') }}"
    deploy_key: "{{ workspace_tl_deploy_key | default('') }}"
    workspace_dir: "/home/ubuntu/.openclaw/workspace-tl"
    ssh_alias: "github-workspace-tl"
    key_file: "workspace-deploy-key-tl"
