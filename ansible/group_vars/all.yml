---
# Non-secret defaults for OpenClaw provisioning.
# Secrets are passed via scripts/provision.sh from Pulumi config.

openclaw_timezone: "Europe/Berlin"
openclaw_model_primary: "anthropic/claude-opus-4-6"
openclaw_model_fallbacks:
  - "anthropic/claude-opus-4-5"
openclaw_thinking_default: "high"

# Custom model definitions (for models not yet in OpenClaw's built-in registry)
openclaw_custom_models:
  mode: "merge"
  providers:
    anthropic:
      baseUrl: "https://api.anthropic.com"
      api: "anthropic-messages"
      models:
        - id: "claude-opus-4-6"
          name: "Claude Opus 4.6"
          reasoning: true
          input: ["text", "image"]
          contextWindow: 1000000
          maxTokens: 128000
openclaw_heartbeat_interval: "30m"
openclaw_elevated_default: "off"

# Compaction safeguard: flush memories to disk before context compression
# Prevents silent loss of in-context state when long sessions get compacted.
# See: https://docs.openclaw.ai/concepts/compaction, openclaw/openclaw#5429
openclaw_compaction_mode: "safeguard"
openclaw_compaction_reserve_tokens_floor: 24000
openclaw_compaction_memory_flush: true
openclaw_compaction_memory_flush_threshold: 8000
openclaw_compaction_memory_flush_prompt: >-
  Distill important context from this session to memory/YYYY-MM-DD.md (today's date).
  Focus on: decisions made, task progress, blockers, lessons learned.
  Skip routine exchanges. If nothing worth storing: NO_FLUSH
openclaw_compaction_memory_flush_system_prompt: >-
  Extract only durable facts worth remembering across sessions. Be selective.

# Concurrency settings
openclaw_max_concurrent: 8
openclaw_subagents_max_concurrent: 16

# Node exec settings (for remote Mac node control)
# ⚠️  SECURITY WARNING: Node exec lets agents run arbitrary shell commands on your
# local machine (Mac) via the OpenClaw node host. This is powerful but dangerous:
# - An agent (or attacker via prompt injection) can read/modify local files
# - If your Mac has Pulumi state, cloud credentials, or SSH keys, they're accessible
# - There is NO sandbox — commands run with your user's full permissions
# See docs/SECURITY.md §5 for the full threat model.
# Only enable this if you understand the risks and have set up the Mac node host.
node_exec_enabled: false

# Exec defaults to sandbox. Agents can target the Mac node on-demand with host=node.
# Node ID is NOT configured here — it's dynamic (changes on re-pairing).
# Pin it manually after pairing: openclaw config set tools.exec.node <id>
openclaw_exec_host: "sandbox"
openclaw_exec_security: "full"       # Unrestricted in sandbox/node; gateway blocked by elevated=false
openclaw_exec_ask: "off"             # No approval prompts (auto-approve node, auto-deny gateway)

# Sandbox settings
openclaw_sandbox_mode: "all"
openclaw_sandbox_workspace_access: "rw"
openclaw_sandbox_docker_network: "codex-proxy-net"
openclaw_sandbox_docker_image: "openclaw-sandbox-custom:latest"
openclaw_sandbox_read_only_root: false  # Allow runtime pip/npm/curl installs (see docs/SECURITY.md §4)

# beads (bd) — AI-native issue tracker (https://github.com/steveyegge/beads)
beads_version: "0.49.6"

# Force sandbox image rebuild (override with -e force_sandbox_rebuild=true)
force_sandbox_rebuild: false

# Force Codex MCP Docker image rebuild (override with -e force_codex_rebuild=true)
force_codex_rebuild: false

# Force Claude Code MCP Docker image rebuild (override with -e force_claude_code_rebuild=true)
force_claude_code_rebuild: false

# Force Pi MCP Docker image rebuild (override with -e force_pi_mcp_rebuild=true)
force_pi_mcp_rebuild: false

# Force plugin reinstall (override with -e force_plugin_reinstall=true)
force_plugin_reinstall: false

# Force qmd reindex (override with -e force_qmd_reindex=true)
force_qmd_reindex: false

# qmd semantic search settings
# Pin to commit hash for reproducibility (bun uses github:user/repo#hash syntax)
qmd_version: "785bbcf319cf60d9e81b8307a1ea89bcdf3159c2"

# Agent definitions
# "main" is the built-in default agent (andy). manon and tl are additional agents.
openclaw_agents:
  - id: "main"
    is_default: true
    deliver_to: "{{ telegram_user_id | default('') }}"
    deliver_type: "dm"
    heartbeat_every: "15m"
  - id: "manon"
    is_default: false
    deliver_to: "{{ telegram_manon_user_id | default('') }}"
    deliver_type: "dm"
    heartbeat_every: "1h"
  - id: "tl"
    is_default: false
    deliver_to: "{{ telegram_group_id | default('') }}"
    deliver_type: "group"
    heartbeat_every: "1h"

# Legacy cron job names (removed during migration to per-agent jobs)
openclaw_legacy_cron_names:
  - "Morning Digest"
  - "Evening Review"
  - "Night Shift"
  - "Weekly Planning"
  - "Weekly Memory Maintenance"
  - "Daily Research Digest"
  - "Weekly Vault Insights"

# Per-agent cron jobs (only created when telegram is configured)
openclaw_cron_jobs:
  # main (andy)
  - name: "main: Daily Standup"
    agent: "main"
    schedule: "30 9 * * *"
    message: "Good morning! Summarize what needs my attention today."
  - name: "main: Night Shift"
    agent: "main"
    schedule: "0 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."
  - name: "main: Weekly Review"
    agent: "main"
    schedule: "0 15 * * 5"
    message: "Weekly review. What was accomplished this week? What is pending?"
  - name: "main: Weekly Planning"
    agent: "main"
    schedule: "0 10 * * 1"
    message: "Weekly planning. Review past week, plan upcoming week priorities."
  - name: "main: Weekly Memory Maintenance"
    agent: "main"
    schedule: "0 3 * * 0"
    message: >-
      Weekly memory maintenance. Do the following:
      1. Read MEMORY.md — check for stale facts, duplicates, contradictions. Fix any found.
      2. Read the last 7 days of daily memory files (memory/YYYY-MM-DD.md) — extract any durable facts or lessons that should be in MEMORY.md but aren't.
      3. Check USER.md for stale client/project statuses.
      4. Review TODO.md — any completed items older than 2 weeks? Move to Completed section. Any blocked items that might be unblocked?
      5. Archive daily logs older than 30 days to memory/archive/ (create if needed).
      6. Write a brief summary of changes made to memory/YYYY-MM-DD.md (today's date).
  - name: "main: Daily Research Digest"
    agent: "main"
    schedule: "0 7 * * 1-5"
    message: >-
      Daily research digest for Andy. Search the web for the latest developments in these areas (past 24h preferred, past week acceptable):
      1. AI Engineering & Agent Frameworks — new releases, breakthroughs, notable papers (MCP, agent architectures, RAG, evals, LLM tooling).
      2. LLM & Foundation Models — new model releases, benchmark results, pricing changes, API updates from Anthropic/OpenAI/Google/xAI/Meta.
      3. AI Consulting & Freelance Market — EU AI Act updates, enterprise AI adoption trends, consulting opportunities.
      4. OpenClaw & Agent Ecosystem — OpenClaw releases, community discussions, competing platforms.
      For each area, run 1-2 targeted web searches. Filter for signal over noise — only include items that would genuinely interest an AI consultant and engineer.
      Output format: Write findings to memory/research/YYYY-MM-DD.md (create memory/research/ if needed).
      Keep each section to 2-3 bullet points max. If a day has nothing notable, write a one-liner and move on. Quality over quantity.
  - name: "main: Weekly Vault Insights"
    agent: "main"
    schedule: "0 9 * * 6"
    message: >-
      Weekly vault insights for Andy. Search Andy's Obsidian vault (via QMD tools and GitHub MCP on pandysp/andy-vault) to surface patterns and insights he might not have noticed.
      Do the following:
      1. Check recent daily notes (past 7 days in the vault) — what themes keep recurring? Any unresolved threads?
      2. Cross-reference active projects — are any client/venture items stale? Deadlines approaching?
      3. Surface forgotten items — search for notes tagged with TODO, follow-up, or similar that haven't been touched in 2+ weeks.
      4. Pattern spotting — any interesting connections between notes that Andy might not see (e.g., a contact mentioned in two unrelated contexts, an idea that connects to an active project)?
      5. Wellbeing check — any patterns in health/energy notes worth flagging?
      Write findings to memory/vault-insights/YYYY-MM-DD.md (create dir if needed).
      Be genuinely useful, not performative. If nothing interesting surfaces, say so in one line. Don't manufacture insights.
  # manon
  # - name: "manon: Daily Standup"
  #   agent: "manon"
  #   schedule: "0 10 * * *"
  #   message: "Good morning! Summarize what needs my attention today."
  - name: "manon: Night Shift"
    agent: "manon"
    schedule: "30 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."
  # - name: "manon: Weekly Review"
  #   agent: "manon"
  #   schedule: "30 15 * * 5"
  #   message: "Weekly review. What was accomplished this week? What is pending?"
  # - name: "manon: Weekly Planning"
  #   agent: "manon"
  #   schedule: "30 10 * * 1"
  #   message: "Weekly planning. Review past week, plan upcoming week priorities."
  # tl
  - name: "tl: Daily Standup"
    agent: "tl"
    schedule: "45 9 * * *"
    message: "Good morning team! Summarize what needs attention today."
  - name: "tl: Night Shift"
    agent: "tl"
    schedule: "15 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."
  - name: "tl: Weekly Review"
    agent: "tl"
    schedule: "15 15 * * 5"
    message: "Weekly review. What was accomplished this week? What is pending?"
  - name: "tl: Weekly Planning"
    agent: "tl"
    schedule: "15 10 * * 1"
    message: "Weekly planning. Review past week, plan upcoming week priorities."

# MCP plugin configuration
openclaw_mcp_adapter:
  source: "https://github.com/pandysp/openclaw-mcp-adapter.git"
  npm_packages:
    - "@modelcontextprotocol/server-github"
    - "@openai/codex"
    - "node-exec-mcp"
  tool_prefix: true
  codex_sandbox: "workspace-write"
  codex_approval: "never"
  codex_docker_image: "codex-mcp:latest"
  codex_version: "0.98.0"        # Pin for reproducibility; update intentionally
  codex_memory_limit: "2g"       # Prevent runaway Codex from exhausting VPS RAM
  codex_proxy_port: 8787         # Port for the credential-injecting reverse proxy
  # Claude Code settings
  claude_code_docker_image: "claude-code-mcp:latest"
  claude_code_version: "2.1.38"     # Pin @anthropic-ai/claude-code CLI for reproducibility
  claude_code_mcp_version: "2.2.0"  # Pin @pandysp/claude-code-mcp server for reproducibility
  claude_code_memory_limit: "2g"    # Monitor and adjust — Claude Code may need more than Codex
  # Pi MCP settings
  pi_mcp_docker_image: "pi-mcp:latest"
  pi_mcp_version: "0.1.2"
  pi_mcp_memory_limit: "1g"    # Lower than Codex/Claude Code — Pi is lighter (session trees, not full IDE)
  pi_mcp_model: "claude-opus-4-6"
  pi_mcp_thinking: "xhigh"
  servers:
    # GitHub MCP servers (one per agent, each with its own PAT)
    - name: "github"
      type: "github"
      token_var: "github_token"
      agent_id: "main"
    - name: "github-manon"
      type: "github"
      token_var: "github_token_manon"
      agent_id: "manon"
    - name: "github-tl"
      type: "github"
      token_var: "github_token_tl"
      agent_id: "tl"
    # Codex MCP servers (one per agent, uses cached ~/.codex/auth.json, workspace-scoped cwd)
    - name: "codex"
      type: "codex"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "codex-manon"
      type: "codex"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "codex-tl"
      type: "codex"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # Claude Code MCP servers (one per agent, reuses claude_setup_token, workspace-scoped cwd)
    - name: "claude"
      type: "claude-code"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "claude-manon"
      type: "claude-code"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "claude-tl"
      type: "claude-code"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # Pi MCP servers (one per agent, reuses claude_setup_token, workspace-scoped cwd)
    - name: "pi"
      type: "pi"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "pi-manon"
      type: "pi"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "pi-tl"
      type: "pi"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # qmd semantic search servers (one per agent, local — no credentials needed)
    - name: "qmd"
      type: "qmd"
      agent_id: "main"
      cwd: "/home/ubuntu/.openclaw/workspace"
    - name: "qmd-manon"
      type: "qmd"
      agent_id: "manon"
      cwd: "/home/ubuntu/.openclaw/workspace-manon"
    - name: "qmd-tl"
      type: "qmd"
      agent_id: "tl"
      cwd: "/home/ubuntu/.openclaw/workspace-tl"
    # Node exec MCP servers (one per agent — Mac shell access via openclaw nodes run)
    - name: "mac"
      type: "node-exec"
      agent_id: "main"
    - name: "mac-manon"
      type: "node-exec"
      agent_id: "manon"
    - name: "mac-tl"
      type: "node-exec"
      agent_id: "tl"

# Claude Code plugins for MCP containers
claude_code_plugins:
  config_dir: "/home/ubuntu/.openclaw/claude-code-plugins"
  marketplaces:
    - repo: "anthropics/claude-plugins-official"
    - repo: "pandysp/claude-plugins"
  plugins:
    - "code-review"
    - "code-simplifier"
    - "commit-commands"
    - "feature-dev"
    - "frontend-design"
    - "hookify"
    - "plugin-dev"
    - "pr-review-toolkit"
    - "ralph-loop"
    - "security-guidance"
    - "ty-lsp@pandysp"
    - "typescript-lsp@pandysp"

# Obsidian vault definitions (cloned into <workspace>/obsidian/<name>/)
# Agents pull/push manually from Docker sandbox. Uses existing GitHub PATs via HTTPS.
openclaw_obsidian_vaults:
  - name: "andy-vault"
    repo_url: "{{ obsidian_andy_vault_repo_url | default('') }}"
    agents: ["main"]
  - name: "manon-vault"
    repo_url: "{{ obsidian_manon_vault_repo_url | default('') }}"
    agents: ["manon"]
  - name: "tl-vault"
    repo_url: "{{ obsidian_tl_vault_repo_url | default('') }}"
    agents: ["main", "manon", "tl"]

# Explicit agent → GitHub PAT mapping for Obsidian HTTPS clones (reuses existing MCP PATs)
openclaw_obsidian_github_tokens:
  main: "{{ github_token | default('') }}"
  manon: "{{ github_token_manon | default('') }}"
  tl: "{{ github_token_tl | default('') }}"

# Workspace git sync definitions (per-agent)
openclaw_workspaces:
  - agent_id: "main"
    repo_url: "{{ workspace_repo_url | default('') }}"
    deploy_key: "{{ workspace_deploy_key | default('') }}"
    workspace_dir: "/home/ubuntu/.openclaw/workspace"
    ssh_alias: "github-workspace-main"
    key_file: "workspace-deploy-key"
  - agent_id: "manon"
    repo_url: "{{ workspace_manon_repo_url | default('') }}"
    deploy_key: "{{ workspace_manon_deploy_key | default('') }}"
    workspace_dir: "/home/ubuntu/.openclaw/workspace-manon"
    ssh_alias: "github-workspace-manon"
    key_file: "workspace-deploy-key-manon"
  - agent_id: "tl"
    repo_url: "{{ workspace_tl_repo_url | default('') }}"
    deploy_key: "{{ workspace_tl_deploy_key | default('') }}"
    workspace_dir: "/home/ubuntu/.openclaw/workspace-tl"
    ssh_alias: "github-workspace-tl"
    key_file: "workspace-deploy-key-tl"
