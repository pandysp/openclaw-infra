---
# Non-secret defaults for OpenClaw provisioning.
# Secrets are passed via scripts/provision.sh from Pulumi config.

openclaw_timezone: "Europe/Berlin"
openclaw_model_primary: "anthropic/claude-opus-4-6"
openclaw_model_fallbacks:
  - "anthropic/claude-opus-4-5"
openclaw_thinking_default: "high"

# Custom model definitions (for models not yet in OpenClaw's built-in registry)
openclaw_custom_models:
  mode: "merge"
  providers:
    anthropic:
      baseUrl: "https://api.anthropic.com"
      api: "anthropic-messages"
      models:
        - id: "claude-opus-4-6"
          name: "Claude Opus 4.6"
          reasoning: true
          input: ["text", "image"]
          contextWindow: 1000000
          maxTokens: 128000
openclaw_version: "2026.2.21"
openclaw_heartbeat_interval: "30m"
openclaw_elevated_default: "off"

# Compaction safeguard: flush memories to disk before context compression
# Prevents silent loss of in-context state when long sessions get compacted.
# See: https://docs.openclaw.ai/concepts/compaction, openclaw/openclaw#5429
openclaw_compaction_mode: "safeguard"
openclaw_compaction_reserve_tokens_floor: 24000
openclaw_compaction_memory_flush: true
openclaw_compaction_memory_flush_threshold: 8000
openclaw_compaction_memory_flush_prompt: >-
  Distill important context from this session to memory/YYYY-MM-DD.md (today's date).
  Focus on: decisions made, task progress, blockers, lessons learned.
  Skip routine exchanges. If nothing worth storing: NO_FLUSH
openclaw_compaction_memory_flush_system_prompt: >-
  Extract only durable facts worth remembering across sessions. Be selective.

# Concurrency settings
openclaw_max_concurrent: 8
openclaw_subagents_max_concurrent: 16

# Node exec settings (for remote Mac node control)
# ⚠️  SECURITY WARNING: Node exec lets agents run arbitrary shell commands on your
# local machine (Mac) via the OpenClaw node host. This is powerful but dangerous:
# - An agent (or attacker via prompt injection) can read/modify local files
# - If your Mac has Pulumi state, cloud credentials, or SSH keys, they're accessible
# - There is NO sandbox — commands run with your user's full permissions
# See docs/SECURITY.md §5 for the full threat model.
# Only enable this if you understand the risks and have set up the Mac node host.
node_exec_enabled: false

# Exec defaults to sandbox. Agents can target the Mac node on-demand with host=node.
# Node ID is NOT configured here — it's dynamic (changes on re-pairing).
# Pin it manually after pairing: openclaw config set tools.exec.node <id>
openclaw_exec_host: "sandbox"
openclaw_exec_security: "full"       # Unrestricted in sandbox/node; gateway blocked by elevated=false
openclaw_exec_ask: "off"             # No approval prompts (auto-approve node, auto-deny gateway)

# Sandbox settings
openclaw_sandbox_mode: "all"
openclaw_sandbox_workspace_access: "rw"
openclaw_sandbox_docker_network: "codex-proxy-net"
openclaw_sandbox_docker_image: "openclaw-sandbox-custom:latest"
openclaw_sandbox_read_only_root: false  # Allow runtime pip/npm/curl installs (see docs/SECURITY.md §4)

# beads (bd) — AI-native issue tracker (https://github.com/steveyegge/beads)
beads_version: "0.49.6"

# Force sandbox image rebuild (override with -e force_sandbox_rebuild=true)
force_sandbox_rebuild: false

# Force Codex MCP Docker image rebuild (override with -e force_codex_rebuild=true)
force_codex_rebuild: false

# Force Claude Code MCP Docker image rebuild (override with -e force_claude_code_rebuild=true)
force_claude_code_rebuild: false

# Force Pi MCP Docker image rebuild (override with -e force_pi_mcp_rebuild=true)
force_pi_mcp_rebuild: false

# Force plugin reinstall (override with -e force_plugin_reinstall=true)
force_plugin_reinstall: false

# Force qmd reindex (override with -e force_qmd_reindex=true)
force_qmd_reindex: false

# qmd semantic search settings
# Pin to commit hash for reproducibility (bun uses github:user/repo#hash syntax)
qmd_version: "785bbcf319cf60d9e81b8307a1ea89bcdf3159c2"

# Agent definitions — single-agent default for new deployments.
# Override in openclaw.yml for multi-agent setups (see openclaw.yml.example).
openclaw_agents:
  - id: "main"
    is_default: true
    deliver_to: "{{ telegram_user_id | default('') }}"
    deliver_type: "dm"
    heartbeat_every: "15m"

# Legacy cron job names (removed during migration to per-agent jobs)
openclaw_legacy_cron_names:
  - "Morning Digest"
  - "Evening Review"
  - "Night Shift"
  - "Weekly Planning"
  - "Weekly Memory Maintenance"
  - "Daily Research Digest"
  - "Weekly Vault Insights"

# Per-agent cron jobs (only created when telegram is configured).
# Generic defaults for single-agent setup. Override in openclaw.yml for multi-agent.
openclaw_cron_jobs:
  - name: "main: Daily Standup"
    agent: "main"
    schedule: "30 9 * * *"
    message: "Good morning! Summarize what needs attention today."
  - name: "main: Night Shift"
    agent: "main"
    schedule: "0 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."

# MCP plugin configuration
openclaw_mcp_adapter:
  npm_package: "@pandysp/openclaw-mcp-adapter"
  npm_packages:
    - "@modelcontextprotocol/server-github"
    - "@openai/codex"
    - "node-exec-mcp"
  tool_prefix: true
  codex_sandbox: "workspace-write"
  codex_approval: "never"
  codex_docker_image: "codex-mcp:latest"
  codex_version: "0.98.0"        # Pin for reproducibility; update intentionally
  codex_memory_limit: "2g"       # Prevent runaway Codex from exhausting VPS RAM
  codex_proxy_port: 8787         # Port for the credential-injecting reverse proxy
  codex_oauth_client_id: "DRivsnm2Mu42T3KOpqdL9p3q9ByGaHfy"  # Codex OAuth client_id for token refresh
  # Claude Code settings
  claude_code_docker_image: "claude-code-mcp:latest"
  claude_code_version: "2.1.38"     # Pin @anthropic-ai/claude-code CLI for reproducibility
  claude_code_mcp_version: "2.2.0"  # Pin @pandysp/claude-code-mcp server for reproducibility
  claude_code_memory_limit: "2g"    # Monitor and adjust — Claude Code may need more than Codex
  # Pi MCP settings
  pi_mcp_docker_image: "pi-mcp:latest"
  pi_mcp_version: "0.1.2"
  pi_mcp_memory_limit: "1g"    # Lower than Codex/Claude Code — Pi is lighter (session trees, not full IDE)
  pi_mcp_model: "claude-opus-4-6"
  pi_mcp_thinking: "xhigh"
  # Note: MCP servers are auto-generated from openclaw_agents × openclaw_mcp_server_types
  # in playbook.yml pre_tasks. The 'servers' key was removed — see _openclaw_mcp_servers.

# MCP server type templates — cross-producted with openclaw_agents to auto-generate
# the per-agent MCP server list (_openclaw_mcp_servers). Each type produces one server
# per agent with mechanical naming: <name_prefix> for main, <name_prefix>-<id> for others.
openclaw_mcp_server_types:
  - type: "github"
    name_prefix: "github"
  - type: "codex"
    name_prefix: "codex"
  - type: "claude-code"
    name_prefix: "claude"
  - type: "pi"
    name_prefix: "pi"
  - type: "qmd"
    name_prefix: "qmd"
  - type: "node-exec"
    name_prefix: "mac"

# Claude Code plugins for MCP containers
claude_code_plugins:
  config_dir: "/home/ubuntu/.openclaw/claude-code-plugins"
  marketplaces:
    - repo: "anthropics/claude-plugins-official"
    - repo: "pandysp/claude-plugins"
  plugins:
    - "code-review"
    - "code-simplifier"
    - "commit-commands"
    - "feature-dev"
    - "frontend-design"
    - "hookify"
    - "plugin-dev"
    - "pr-review-toolkit"
    - "ralph-loop"
    - "security-guidance"
    - "ty-lsp@pandysp"
    - "typescript-lsp@pandysp"

# Obsidian vault definitions (cloned into <workspace>/obsidian/<name>/).
# Default: none. Override in openclaw.yml for vault access.
openclaw_obsidian_vaults: []
# Note: openclaw_obsidian_github_tokens and openclaw_workspaces are now auto-generated
# in playbook.yml pre_tasks from openclaw_agents. See _openclaw_obsidian_github_tokens
# and _openclaw_workspaces. Override by defining these variables in openclaw.yml.
