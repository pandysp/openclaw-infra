---
# Non-secret defaults for OpenClaw provisioning.
# Secrets are passed via scripts/provision.sh from Pulumi config.

openclaw_timezone: "Europe/Berlin"
openclaw_model_primary: "anthropic/claude-opus-4-6"
openclaw_model_fallbacks:
  - "anthropic/claude-opus-4-5"
openclaw_thinking_default: "high"

# Custom model definitions (for models not yet in OpenClaw's built-in registry)
openclaw_custom_models:
  mode: "merge"
  providers:
    anthropic:
      baseUrl: "https://api.anthropic.com"
      api: "anthropic-messages"
      models:
        - id: "claude-opus-4-6"
          name: "Claude Opus 4.6"
          reasoning: true
          input: ["text", "image"]
          # 200K limit: Claude Max (subscription / setup-token auth) does NOT support 1M context.
          # Anthropic rejects the context-1m-2025-08-07 beta header for sk-ant-oat* OAuth tokens.
          # OpenClaw auto-skips context1m when it detects subscription auth (PR #24620, Feb 2026).
          #
          # This value drives compaction timing: OpenClaw compacts at
          #   contextWindow - reserveTokensFloor  (see openclaw_compaction_reserve_tokens_floor below).
          # Setting it to 1000000 would push the compaction trigger to ~976K — the API rejects at
          # 200K first, compaction never fires, and sessions die with duplicate Telegram deliveries.
          #
          # API key auth (sk-ant-api03-*): if you switch away from Claude Max, you can set:
          #   contextWindow: 1000000
          #   context1m: true   ← OpenClaw injects the beta header automatically
          # Still keep reserveTokensFloor high (~50K) to compact well before 200K — extended context
          # bills the ENTIRE input at the premium rate ($10 vs $5/MTok input, $37.50 vs $25/MTok
          # output), not just the excess. Staying under 200K is almost always cheaper.
          contextWindow: 200000
          maxTokens: 128000
openclaw_version: "2026.2.26"
openclaw_heartbeat_interval: "30m"
openclaw_agent_timeout_seconds: 1500  # 25 minutes per conversation turn (default: 600)
openclaw_cooldown_failure_window_hours: 1  # reset cooldown error count after 1h (default: 24)
openclaw_elevated_default: "off"

# Voice transcription (Groq Whisper)
# Set via: pulumi config set groqApiKey --secret
openclaw_audio_provider: "groq"
openclaw_audio_model: "whisper-large-v3-turbo"
openclaw_groq_base_url: "https://api.groq.com/openai/v1"

# Compaction safeguard: flush memories to disk before context compression
# Prevents silent loss of in-context state when long sessions get compacted.
# See: https://docs.openclaw.ai/concepts/compaction, openclaw/openclaw#5429
openclaw_compaction_mode: "safeguard"
openclaw_compaction_reserve_tokens_floor: 50000   # was 24000; 50K gives compaction room within 200K API limit
openclaw_compaction_memory_flush: true
openclaw_compaction_memory_flush_threshold: 20000  # was 8000; flush memories 20K tokens before compaction trigger
openclaw_compaction_memory_flush_prompt: >-
  Distill important context from this session to logs/YYYY-MM-DD.md (today's date).
  Focus on: decisions made, task progress, blockers, lessons learned.
  Skip routine exchanges. If nothing worth storing: NO_FLUSH
openclaw_compaction_memory_flush_system_prompt: >-
  Extract only durable facts worth remembering across sessions. Be selective.

# Concurrency settings
openclaw_max_concurrent: 8
openclaw_subagents_max_concurrent: 16

# Node exec settings (for remote Mac node control)
# ⚠️  SECURITY WARNING: Node exec lets agents run arbitrary shell commands on your
# local machine (Mac) via the OpenClaw node host. This is powerful but dangerous:
# - An agent (or attacker via prompt injection) can read/modify local files
# - If your Mac has Pulumi state, cloud credentials, or SSH keys, they're accessible
# - There is NO sandbox — commands run with your user's full permissions
# See docs/SECURITY.md §5 for the full threat model.
# Only enable this if you understand the risks and have set up the Mac node host.
node_exec_enabled: false

# Exec defaults to sandbox. Agents can target the Mac node on-demand with host=node.
# Node ID is NOT configured here — it's dynamic (changes on re-pairing).
# Pin it manually after pairing: openclaw config set tools.exec.node <id>
openclaw_exec_host: "sandbox"
openclaw_exec_security: "full"       # Unrestricted in sandbox/node; gateway blocked by elevated=false
openclaw_exec_ask: "off"             # No approval prompts (auto-approve node, auto-deny gateway)

# Sandbox settings
openclaw_sandbox_mode: "all"
openclaw_sandbox_workspace_access: "rw"
openclaw_sandbox_docker_network: "bridge"
openclaw_sandbox_docker_image: "openclaw-sandbox-custom:latest"
openclaw_sandbox_read_only_root: false  # Allow runtime pip/npm/curl installs (see docs/SECURITY.md §4)

# beads (bd) — AI-native issue tracker (https://github.com/steveyegge/beads)
# Pinned to 0.55.4: last version with embedded Dolt (no external server). v0.56.0+ requires
# a running Dolt SQL server. v0.51.0 removed the daemon that caused zombie process accumulation.
beads_version: "0.55.4"

# Force sandbox image rebuild (override with -e force_sandbox_rebuild=true)
force_sandbox_rebuild: false

# Force Codex MCP Docker image rebuild (override with -e force_codex_rebuild=true)
force_codex_rebuild: false

# Force Claude Code MCP Docker image rebuild (override with -e force_claude_code_rebuild=true)
force_claude_code_rebuild: false

# Force Pi MCP Docker image rebuild (override with -e force_pi_mcp_rebuild=true)
force_pi_mcp_rebuild: false

# Force plugin reinstall (override with -e force_plugin_reinstall=true)
force_plugin_reinstall: false

# Force qmd reindex (override with -e force_qmd_reindex=true)
force_qmd_reindex: false

# qmd semantic search settings
# @tobilu/qmd published on npm — pin with semver
qmd_version: "1.0.7"
# Base port for qmd HTTP daemons (one per agent, assigned by position in qmd_workspaces).
# Port N+0 = first agent, N+1 = second, etc. Re-run --tags qmd,plugins if agents change.
qmd_http_base_port: 8191
# Additional qmd collections beyond the base 'workspace' collection (which always indexes
# the entire workspace root). Use these for targeted search (-c <name>) on specific
# subdirectories. Paths are relative to the workspace root. qmd silently skips missing paths.
# Override in openclaw.yml with deployment-specific collections.
qmd_extra_collections: []

# Agent definitions — single-agent default for new deployments.
# Override in openclaw.yml for multi-agent setups (see openclaw.yml.example).
openclaw_agents:
  - id: "main"
    is_default: true
    deliver_to: "{{ telegram_user_id | default('') }}"
    deliver_type: "dm"
    deliver_channel: "telegram"
    heartbeat_every: "15m"

# Legacy cron job names (removed during migration to per-agent jobs)
openclaw_legacy_cron_names:
  - "Morning Digest"
  - "Evening Review"
  - "Night Shift"
  - "Weekly Planning"
  - "Weekly Memory Maintenance"
  - "Daily Research Digest"
  - "Weekly Vault Insights"

# Per-agent cron jobs (only created when telegram is configured).
# Generic defaults for single-agent setup. Override in openclaw.yml for multi-agent.
openclaw_cron_jobs:
  - name: "main: Daily Standup"
    agent: "main"
    schedule: "30 9 * * *"
    message: "Good morning! Summarize what needs attention today."
  - name: "main: Night Shift"
    agent: "main"
    schedule: "0 23 * * *"
    message: "Night shift. Review notes, organize, triage, work through tasks. Prepare morning summary."

# MCP plugin configuration
openclaw_mcp_adapter:
  npm_package: "@pandysp/openclaw-mcp-adapter"
  npm_packages:
    - "@modelcontextprotocol/server-github"
    - "@openai/codex"
    - "node-exec-mcp"
  tool_prefix: true
  codex_sandbox: "workspace-write"
  codex_approval: "never"
  codex_docker_image: "codex-mcp:latest"
  codex_version: "0.98.0"        # Pin for reproducibility; update intentionally
  codex_memory_limit: "2g"       # Prevent runaway Codex from exhausting VPS RAM
  codex_proxy_port: 8787         # Port for the credential-injecting reverse proxy
  codex_oauth_client_id: "DRivsnm2Mu42T3KOpqdL9p3q9ByGaHfy"  # Codex OAuth client_id for token refresh
  # Claude Code settings
  claude_code_docker_image: "claude-code-mcp:latest"
  claude_code_version: "2.1.38"     # Pin @anthropic-ai/claude-code CLI for reproducibility
  claude_code_mcp_version: "2.2.0"  # Pin @pandysp/claude-code-mcp server for reproducibility
  claude_code_memory_limit: "2g"    # Monitor and adjust — Claude Code may need more than Codex
  # Pi MCP settings
  pi_mcp_docker_image: "pi-mcp:latest"
  pi_mcp_version: "0.1.2"
  pi_mcp_memory_limit: "1g"    # Lower than Codex/Claude Code — Pi is lighter (session trees, not full IDE)
  pi_mcp_model: "claude-opus-4-6"
  pi_mcp_thinking: "xhigh"
  # Note: MCP servers are auto-generated from openclaw_agents × openclaw_mcp_server_types
  # in playbook.yml pre_tasks. The 'servers' key was removed — see _openclaw_mcp_servers.

# MCP server type templates — cross-producted with openclaw_agents to auto-generate
# the per-agent MCP server list (_openclaw_mcp_servers). Each type produces one server
# per agent with mechanical naming: <name_prefix> for main, <name_prefix>-<id> for others.
openclaw_mcp_server_types:
  - type: "github"
    name_prefix: "github"
  - type: "codex"
    name_prefix: "codex"
  - type: "claude-code"
    name_prefix: "claude"
  - type: "pi"
    name_prefix: "pi"
  - type: "qmd"
    name_prefix: "qmd"
  - type: "node-exec"
    name_prefix: "mac"

# Claude Code plugins for MCP containers
claude_code_plugins:
  config_dir: "/home/ubuntu/.openclaw/claude-code-plugins"
  marketplaces:
    - repo: "anthropics/claude-plugins-official"
    - repo: "pandysp/claude-plugins"
    - repo: "astral-sh/claude-code-plugins"
  plugins:
    - "code-review"
    - "code-simplifier"
    - "commit-commands"
    - "feature-dev"
    - "frontend-design"
    - "hookify"
    - "plugin-dev"
    - "pr-review-toolkit"
    - "ralph-loop"
    - "security-guidance"
    - "astral@astral-sh"
    - "typescript-lsp@pandysp"

# Obsidian Headless Sync (obsidian-headless npm package)
# Runs per-workspace sync daemons for near-real-time Obsidian Sync cloud access.
# Override in openclaw.yml to enable and configure per-deployment.
obsidian_headless_enabled: false
obsidian_headless_version: "0.0.3"
obsidian_headless_memory_max: "256M"
obsidian_headless_agents: []
obsidian_headless_initial_sync_timeout: 300
# Common non-vault directories to exclude from Obsidian Sync.
# Override in openclaw.yml to add workspace-specific exclusions.
obsidian_headless_excluded_folders: ".git,.venv,node_modules,.cache,.env"

# Obsidian vault definitions (cloned into <workspace>/obsidian/<name>/).
# Default: none. Override in openclaw.yml for vault access.
openclaw_obsidian_vaults: []
# Note: openclaw_obsidian_github_tokens and openclaw_workspaces are now auto-generated
# in playbook.yml pre_tasks from openclaw_agents. See _openclaw_obsidian_github_tokens
# and _openclaw_workspaces. Override by defining these variables in openclaw.yml.
